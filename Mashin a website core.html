<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Автосалон - система управления</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .car-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .car-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <img src="https://placehold.co/200x100?text=AutoSalon" alt="Логотип автосалона - автомобиль на фоне городского пейзажа" class="mr-4">
                    <h1 class="text-3xl font-bold text-gray-800">Система управления автосалоном</h1>
                </div>
                <button id="addCarBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Добавить автомобиль</button>
            </div>
            
            <div class="flex border-b mt-4">
                <button class="tab-btn active px-4 py-2 font-medium" data-tab="cars">Автомобили</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="suppliers">Поставщики</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="cities">Города</button>
                <button class="tab-btn px-4 py-2 font-medium" data-tab="brands">Марки</button>
            </div>
        </header>
        
        <!-- Поиск и фильтрация -->
        <div class="mb-6 bg-white p-4 rounded-lg shadow">
            <div class="flex flex-wrap items-center gap-4">
                <div class="relative flex-grow">
                    <input type="text" id="searchInput" placeholder="Поиск по модели, марке..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                </div>
                <div>
                    <select id="brandFilter" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                        <option value="">Все марки</option>
                    </select>
                </div>
                <button id="searchBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Поиск</button>
                <button id="resetBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Сбросить</button>
            </div>
        </div>
        
        <!-- Контент вкладок -->
        <div class="tab-content active" id="carsTab">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="carsContainer">
                <!-- Карточки автомобилей будут здесь -->
            </div>
        </div>
        
        <div class="tab-content" id="suppliersTab">
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Справочник поставщиков</h2>
                <button id="addSupplierBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition mb-4">Добавить поставщика</button>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">ID</th>
                                <th class="py-2 px-4 border-b">Название</th>
                                <th class="py-2 px-4 border-b">Контактное лицо</th>
                                <th class="py-2 px-4 border-b">Телефон</th>
                                <th class="py-2 px-4 border-b">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTable">
                            <!-- Данные поставщиков будут здесь -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="citiesTab">
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Справочник городов</h2>
                <button id="addCityBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition mb-4">Добавить город</button>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">ID</th>
                                <th class="py-2 px-4 border-b">Название</th>
                                <th class="py-2 px-4 border-b">Регион</th>
                                <th class="py-2 px-4 border-b">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="citiesTable">
                            <!-- Данные городов будут здесь -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="brandsTab">
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Справочник марок автомобилей</h2>
                <button id="addBrandBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition mb-4">Добавить марку</button>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">ID</th>
                                <th class="py-2 px-4 border-b">Название</th>
                                <th class="py-2 px-4 border-b">Страна</th>
                                <th class="py-2 px-4 border-b">Год основания</th>
                                <th class="py-2 px-4 border-b">Действия</th>
                            </tr>
                        </thead>
                        <tbody id="brandsTable">
                            <!-- Данные марок будут здесь -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Модальные окна -->
    <div id="carModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl font-bold mb-4" id="modalTitle">Добавить новый автомобиль</h2>
            <form id="carForm">
                <input type="hidden" id="carId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Марка*</label>
                        <select id="carBrand" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                            <option value="">Выберите марку</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Модель*</label>
                        <input type="text" id="carModel" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Год выпуска*</label>
                        <input type="number" id="carYear" min="1900" max="2099" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Цена*</label>
                        <input type="number" id="carPrice" min="0" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Цвет</label>
                        <input type="text" id="carColor" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Тип кузова</label>
                        <select id="carBodyType" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <option value="">Выберите тип</option>
                            <option value="sedan">Седан</option>
                            <option value="hatchback">Хэтчбек</option>
                            <option value="suv">Внедорожник</option>
                            <option value="coupe">Купе</option>
                            <option value="convertible">Кабриолет</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Поставщик</label>
                        <select id="carSupplier" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <option value="">Выберите поставщика</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Город</label>
                        <select id="carCity" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                            <option value="">Выберите город</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Описание комплектации</label>
                    <textarea id="carEquipment" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Изображение автомобиля</label>
                    <input type="file" id="carImageUpload" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <div class="mt-2">
                        <img id="carImagePreview" src="https://placehold.co/600x400?text=Car+Image" alt="Загруженное изображение автомобиля" class="car-image">
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="close-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Отмена</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl font-bold mb-4" id="supplierModalTitle">Добавить нового поставщика</h2>
            <form id="supplierForm">
                <input type="hidden" id="supplierId">
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Название компании*</label>
                        <input type="text" id="supplierName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Контактное лицо*</label>
                        <input type="text" id="supplierContact" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Телефон*</label>
                        <input type="tel" id="supplierPhone" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input type="email" id="supplierEmail" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Адрес</label>
                        <textarea id="supplierAddress" rows="2" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300"></textarea>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="close-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Отмена</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="cityModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl font-bold mb-4" id="cityModalTitle">Добавить новый город</h2>
            <form id="cityForm">
                <input type="hidden" id="cityId">
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Название города*</label>
                        <input type="text" id="cityName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Регион*</label>
                        <input type="text" id="cityRegion" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Страна*</label>
                        <input type="text" id="cityCountry" value="Россия" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="close-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Отмена</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="brandModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="text-2xl font-bold mb-4" id="brandModalTitle">Добавить новую марку</h2>
            <form id="brandForm">
                <input type="hidden" id="brandId">
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Название марки*</label>
                        <input type="text" id="brandName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Страна*</label>
                        <input type="text" id="brandCountry" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Год основания</label>
                        <input type="number" id="brandYear" min="1800" max="2099" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Описание</label>
                        <textarea id="brandDescription" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Логотип</label>
                        <input type="file" id="brandLogoUpload" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300">
                        <div class="mt-2">
                            <img id="brandLogoPreview" src="https://placehold.co/200x100?text=Brand+Logo" alt="Логотип марки автомобиля" class="car-image">
                        </div>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" class="close-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Отмена</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">Сохранить</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close">&times;</span>
            <h2 class="text-xl font-bold mb-4" id="confirmModalTitle">Подтвердите действие</h2>
            <p id="confirmModalText">Вы уверены, что хотите удалить этот элемент?</p>
            <div class="flex justify-end gap-2 mt-6">
                <button type="button" class="close-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition">Отмена</button>
                <button type="button" id="confirmBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition">Удалить</button>
            </div>
        </div>
    </div>

    <script>
        // Имитация базы данных
        let cars = [
            {
                id: 1,
                brand: "Toyota",
                model: "Camry",
                year: 2022,
                price: 2500000,
                color: "белый",
                bodyType: "sedan",
                supplier: "AutoImport",
                city: "Москва",
                equipment: "Полная комплектация: кожаный салон, адаптивный круиз-контроль, система мониторинга слепых зон",
                image: "https://placehold.co/600x400?text=Toyota+Camry"
            },
            {
                id: 2,
                brand: "BMW",
                model: "X5",
                year: 2021,
                price: 4500000,
                color: "черный",
                bodyType: "suv",
                supplier: "EuroMotors",
                city: "Санкт-Петербург",
                equipment: "M-пакет: спортивный руль, усиленная подвеска, спортивные сиденья с электроприводом",
                image: "https://placehold.co/600x400?text=BMW+X5"
            },
            {
                id: 3,
                brand: "Kia",
                model: "Rio",
                year: 2023,
                price: 1400000,
                color: "серый",
                bodyType: "sedan",
                supplier: "KiaMotors",
                city: "Казань",
                equipment: "Комфорт: климат-контроль, мультимедийная система с Apple CarPlay и Android Auto",
                image: "https://placehold.co/600x400?text=Kia+Rio"
            }
        ];
        
        let suppliers = [
            { id: 1, name: "AutoImport", contact: "Иванов И.И.", phone: "+79101234567", email: "info@autoimport.ru", address: "Москва, ул. Ленина, 1" },
            { id: 2, name: "EuroMotors", contact: "Петров П.П.", phone: "+79107654321", email: "sales@euromotors.ru", address: "Санкт-Петербург, Невский пр., 10" },
            { id: 3, name: "KiaMotors", contact: "Сидоров С.С.", phone: "+79151234567", email: "support@kia.ru", address: "Казань, ул. Баумана, 15" }
        ];
        
        let cities = [
            { id: 1, name: "Москва", region: "Московская область", country: "Россия" },
            { id: 2, name: "Санкт-Петербург", region: "Ленинградская область", country: "Россия" },
            { id: 3, name: "Казань", region: "Татарстан", country: "Россия" },
            { id: 4, name: "Екатеринбург", region: "Свердловская область", country: "Россия" }
        ];
        
        let brands = [
            { id: 1, name: "Toyota", country: "Япония", year: 1937, description: "Японский производитель автомобилей", logo: "https://placehold.co/200x100?text=Toyota" },
            { id: 2, name: "BMW", country: "Германия", year: 1916, description: "Немецкий производитель автомобилей и мотоциклов", logo: "https://placehold.co/200x100?text=BMW" },
            { id: 3, name: "Kia", country: "Южная Корея", year: 1944, description: "Корейский производитель автомобилей", logo: "https://placehold.co/200x100?text=Kia" },
            { id: 4, name: "Lada", country: "Россия", year: 1966, description: "Российский производитель автомобилей", logo: "https://placehold.co/200x100?text=Lada" }
        ];
        
        // DOM элементы
        const carsContainer = document.getElementById('carsContainer');
        const suppliersTable = document.getElementById('suppliersTable');
        const citiesTable = document.getElementById('citiesTable');
        const brandsTable = document.getElementById('brandsTable');
        const brandFilter = document.getElementById('brandFilter');
        const searchInput = document.getElementById('searchInput');
        
        // Модальные окна
        const carModal = document.getElementById('carModal');
        const supplierModal = document.getElementById('supplierModal');
        const cityModal = document.getElementById('cityModal');
        const brandModal = document.getElementById('brandModal');
        const confirmModal = document.getElementById('confirmModal');
        
        // Формы
        const carForm = document.getElementById('carForm');
        const supplierForm = document.getElementById('supplierForm');
        const cityForm = document.getElementById('cityForm');
        const brandForm = document.getElementById('brandForm');
        
        // Кнопки
        const addCarBtn = document.getElementById('addCarBtn');
        const addSupplierBtn = document.getElementById('addSupplierBtn');
        const addCityBtn = document.getElementById('addCityBtn');
        const addBrandBtn = document.getElementById('addBrandBtn');
        const searchBtn = document.getElementById('searchBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', () => {
            // Инициализация данных
            renderCars(cars);
            renderSuppliers(suppliers);
            renderCities(cities);
            renderBrands(brands);
            
            // Заполняем фильтр марок
            updateBrandFilter();
            
            // Настройка вкладок
            setupTabs();
            
            // Настройка модальных окон
            setupModals();
            
            // Настройка форм
            setupForms();
            
            // Настройка обработчиков кнопок
            addCarBtn.addEventListener('click', () => openCarModal());
            addSupplierBtn.addEventListener('click', () => openSupplierModal());
            addCityBtn.addEventListener('click', () => openCityModal());
            addBrandBtn.addEventListener('click', () => openBrandModal());
            searchBtn.addEventListener('click', () => searchCars());
            resetBtn.addEventListener('click', () => resetFilters());
            
            // Поиск при нажатии Enter
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchCars();
                }
            });
        });
        
        // Функции рендеринга
        function renderCars(carsToRender) {
            carsContainer.innerHTML = '';
            carsToRender.forEach(car => {
                const carCard = document.createElement('div');
                carCard.className = 'bg-white rounded-lg shadow overflow-hidden car-card transition';
                carCard.innerHTML = `
                    <div class="car-image-container">
                        <img src="${car.image}" alt="Автомобиль ${car.brand} ${car.model} ${car.color} ${car.year} года выпуска" class="car-image">
                    </div>
                    <div class="p-4">
                        <h3 class="text-xl font-bold">${car.brand} ${car.model}</h3>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-600">${car.year} год</span>
                            <span class="text-blue-500 font-bold">${formatPrice(car.price)} ₽</span>
                        </div>
                        <p class="text-gray-700 mb-4">${car.equipment.substring(0, 60)}...</p>
                        <div class="flex justify-between">
                            <span class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm">${car.bodyType}</span>
                            <span class="inline-block bg-gray-200 rounded-full px-3 py-1 text-sm">${car.city}</span>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button class="edit-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg transition" data-id="${car.id}">Редактировать</button>
                            <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg transition" data-id="${car.id}">Удалить</button>
                        </div>
                    </div>
                `;
                carsContainer.appendChild(carCard);
            });
            
            // Добавляем обработчики событий для новых кнопок
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    openCarModal(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    showConfirmModal('Удалить автомобиль', `Вы уверены, что хотите удалить автомобиль ID: ${id}?`, () => deleteCar(id));
                });
            });
        }
        
        function renderSuppliers(suppliersToRender) {
            suppliersTable.innerHTML = '';
            suppliersToRender.forEach(supplier => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${supplier.id}</td>
                    <td class="py-2 px-4 border-b">${supplier.name}</td>
                    <td class="py-2 px-4 border-b">${supplier.contact}</td>
                    <td class="py-2 px-4 border-b">${supplier.phone}</td>
                    <td class="py-2 px-4 border-b">
                        <button class="edit-btn bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm transition" data-id="${supplier.id}">Ред</button>
                        <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm transition" data-id="${supplier.id}">Удл</button>
                    </td>
                `;
                suppliersTable.appendChild(row);
            });
            
            // Добавляем обработчики событий для новых кнопок
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    openSupplierModal(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    showConfirmModal('Удалить поставщика', `Вы уверены, что хотите удалить поставщика ID: ${id}?`, () => deleteSupplier(id));
                });
            });
        }
        
        function renderCities(citiesToRender) {
            citiesTable.innerHTML = '';
            citiesToRender.forEach(city => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${city.id}</td>
                    <td class="py-2 px-4 border-b">${city.name}</td>
                    <td class="py-2 px-4 border-b">${city.region}</td>
                    <td class="py-2 px-4 border-b">
                        <button class="edit-btn bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm transition" data-id="${city.id}">Ред</button>
                        <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm transition" data-id="${city.id}">Удл</button>
                    </td>
                `;
                citiesTable.appendChild(row);
            });
            
            // Добавляем обработчики событий для новых кнопок
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    openCityModal(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    showConfirmModal('Удалить город', `Вы уверены, что хотите удалить город ID: ${id}?`, () => deleteCity(id));
                });
            });
        }
        
        function renderBrands(brandsToRender) {
            brandsTable.innerHTML = '';
            brandsToRender.forEach(brand => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${brand.id}</td>
                    <td class="py-2 px-4 border-b">${brand.name}</td>
                    <td class="py-2 px-4 border-b">${brand.country}</td>
                    <td class="py-2 px-4 border-b">${brand.year}</td>
                    <td class="py-2 px-4 border-b">
                        <button class="edit-btn bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm transition" data-id="${brand.id}">Ред</button>
                        <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm transition" data-id="${brand.id}">Удл</button>
                    </td>
                `;
                brandsTable.appendChild(row);
            });
            
            // Добавляем обработчики событий для новых кнопок
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    openBrandModal(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    showConfirmModal('Удалить марку', `Вы уверены, что хотите удалить марку ID: ${id}?`, () => deleteBrand(id));
                });
            });
        }
        
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    
                    // Скрываем все содержимое вкладок
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Убираем активный класс у всех кнопок вкладок
                    tabBtns.forEach(tabBtn => {
                        tabBtn.classList.remove('active');
                    });
                    
                    // Показываем содержимое выбранной вкладки
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                    
                    // Добавляем активный класс к текущей кнопке
                    btn.classList.add('active');
                });
            });
        }
        
        function setupModals() {
            // Закрытие модальных окон
            const closeBtns = document.querySelectorAll('.close, .close-modal-btn');
            closeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    closeAllModals();
                });
            });
            
            // Закрытие при клике вне модального окна
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    closeAllModals();
                }
            });
        }
        
        function setupForms() {
            // Инициализация выпадающих списков
            updateSelectOptions('#carBrand', brands, 'Выберите марку');
            updateSelectOptions('#carSupplier', suppliers, 'Выберите поставщика');
            updateSelectOptions('#carCity', cities, 'Выберите город');
            
            // Обработка формы автомобиля
            carForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveCar();
            });
            
            // Обработка формы поставщика
            supplierForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveSupplier();
            });
            
            // Обработка формы города
            cityForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveCity();
            });
            
            // Обработка формы марки
            brandForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveBrand();
            });
        }
        
        function updateSelectOptions(selector, items, placeholder) {
            const select = document.querySelector(selector);
            // Сохраняем текущее выбранное значение
            const currentValue = select.value;
            
            // Очищаем список опций, но оставляем первый элемент (placeholder)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Добавляем новые опции
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.name;
                select.appendChild(option);
            });
            
            // Восстанавливаем ранее выбранное значение, если оно есть
            if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                select.value = currentValue;
            }
        }
        
        function updateBrandFilter() {
            brandFilter.innerHTML = '<option value="">Все марки</option>';
            brands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand.id;
                option.textContent = brand.name;
                brandFilter.appendChild(option);
            });
        }
        
        // Функции для работы с модальными окнами
        function openCarModal(id = null) {
            document.getElementById('modalTitle').textContent = id ? 'Редактировать автомобиль' : 'Добавить новый автомобиль';
            
            // Очищаем форму
            carForm.reset();
            document.getElementById('carImagePreview').src = 'https://placehold.co/600x400?text=Car+Image';
            
            // Устанавливаем ID, если редактирование
            document.getElementById('carId').value = id || '';
            
            // Заполняем форму данными, если редактирование
            if (id) {
                const car = cars.find(c => c.id === id);
                if (car) {
                    document.getElementById('carBrand').value = brands.find(b => b.name === car.brand)?.id || '';
                    document.getElementById('carModel').value = car.model;
                    document.getElementById('carYear').value = car.year;
                    document.getElementById('carPrice').value = car.price;
                    document.getElementById('carColor').value = car.color;
                    document.getElementById('carBodyType').value = car.bodyType;
                    document.getElementById('carSupplier').value = suppliers.find(s => s.name === car.supplier)?.id || '';
                    document.getElementById('carCity').value = cities.find(c => c.name === car.city)?.id || '';
                    document.getElementById('carEquipment').value = car.equipment;
                    document.getElementById('carImagePreview').src = car.image;
                }
            }
            
            // Показываем модальное окно
            closeAllModals();
            carModal.style.display = 'block';
        }
        
        function openSupplierModal(id = null) {
            document.getElementById('supplierModalTitle').textContent = id ? 'Редактировать поставщика' : 'Добавить нового поставщика';
            
            // Очищаем форму
            supplierForm.reset();
            
            // Устанавливаем ID, если редактирование
            document.getElementById('supplierId').value = id || '';
            
            // Заполняем форму данными, если редактирование
            if (id) {
                const supplier = suppliers.find(s => s.id === id);
                if (supplier) {
                    document.getElementById('supplierName').value = supplier.name;
                    document.getElementById('supplierContact').value = supplier.contact;
                    document.getElementById('supplierPhone').value = supplier.phone;
                    document.getElementById('supplierEmail').value = supplier.email || '';
                    document.getElementById('supplierAddress').value = supplier.address || '';
                }
            }
            
            // Показываем модальное окно
            closeAllModals();
            supplierModal.style.display = 'block';
        }
        
        function openCityModal(id = null) {
            document.getElementById('cityModalTitle').textContent = id ? 'Редактировать город' : 'Добавить новый город';
            
            // Очищаем форму
            cityForm.reset();
            
            // Устанавливаем ID, если редактирование
            document.getElementById('cityId').value = id || '';
            
            // Заполняем форму данными, если редактирование
            if (id) {
                const city = cities.find(c => c.id === id);
                if (city) {
                    document.getElementById('cityName').value = city.name;
                    document.getElementById('cityRegion').value = city.region;
                    document.getElementById('cityCountry').value = city.country;
                }
            }
            
            // Показываем модальное окно
            closeAllModals();
            cityModal.style.display = 'block';
        }
        
        function openBrandModal(id = null) {
            document.getElementById('brandModalTitle').textContent = id ? 'Редактировать марку' : 'Добавить новую марку';
            
            // Очищаем форму
            brandForm.reset();
            document.getElementById('brandLogoPreview').src = 'https://placehold.co/200x100?text=Brand+Logo';
            
            // Устанавливаем ID, если редактирование
            document.getElementById('brandId').value = id || '';
            
            // Заполняем форму данными, если редактирование
            if (id) {
                const brand = brands.find(b => b.id === id);
                if (brand) {
                    document.getElementById('brandName').value = brand.name;
                    document.getElementById('brandCountry').value = brand.country;
                    document.getElementById('brandYear').value = brand.year || '';
                    document.getElementById('brandDescription').value = brand.description || '';
                    document.getElementById('brandLogoPreview').src = brand.logo || 'https://placehold.co/200x100?text=Brand+Logo';
                }
            }
            
            // Показываем модальное окно
            closeAllModals();
            brandModal.style.display = 'block';
        }
        
        function showConfirmModal(title, text, confirmAction) {
            document.getElementById('confirmModalTitle').textContent = title;
            document.getElementById('confirmModalText').textContent = text;
            
            const confirmBtn = document.getElementById('confirmBtn');
            // Удаляем предыдущие обработчики
            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
            
            // Добавляем новый обработчик
            document.getElementById('confirmBtn').addEventListener('click', () => {
                confirmAction();
                closeAllModals();
            });
            
            // Показываем модальное окно
            closeAllModals();
            confirmModal.style.display = 'block';
        }
        
        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // Функции CRUD для автомобилей
        function saveCar() {
            const id = document.getElementById('carId').value;
            const brandId = document.getElementById('carBrand').value;
            const brand = brands.find(b => b.id == brandId)?.name || '';
            
            const supplierId = document.getElementById('carSupplier').value;
            const supplier = suppliers.find(s => s.id == supplierId)?.name || '';
            
            const cityId = document.getElementById('carCity').value;
            const city = cities.find(c => c.id == cityId)?.name || '';
            
            const carData = {
                brand: brand,
                model: document.getElementById('carModel').value,
                year: parseInt(document.getElementById('carYear').value),
                price: parseInt(document.getElementById('carPrice').value),
                color: document.getElementById('carColor').value,
                bodyType: document.getElementById('carBodyType').value,
                supplier: supplier,
                city: city,
                equipment: document.getElementById('carEquipment').value,
                image: document.getElementById('carImagePreview').src
            };
            
            if (id) {
                // Редактирование существующего автомобиля
                const index = cars.findIndex(c => c.id == id);
                if (index !== -1) {
                    cars[index] = { ...cars[index], ...carData };
                }
            } else {
                // Добавление нового автомобиля
                const newId = cars.length > 0 ? Math.max(...cars.map(c => c.id)) + 1 : 1;
                cars.push({ id: newId, ...carData });
            }
            
            renderCars(cars);
            closeAllModals();
        }
        
        function deleteCar(id) {
            cars = cars.filter(c => c.id !== id);
            renderCars(cars);
        }
        
        // Функции CRUD для поставщиков
        function saveSupplier() {
            const id = document.getElementById('supplierId').value;
            const supplierData = {
                name: document.getElementById('supplierName').value,
                contact: document.getElementById('supplierContact').value,
                phone: document.getElementById('supplierPhone').value,
                email: document.getElementById('supplierEmail').value,
                address: document.getElementById('supplierAddress').value
            };
            
            if (id) {
                // Редактирование существующего поставщика
                const index = suppliers.findIndex(s => s.id == id);
                if (index !== -1) {
                    suppliers[index] = { ...suppliers[index], ...supplierData };
                }
            } else {
                // Добавление нового поставщика
                const newId = suppliers.length > 0 ? Math.max(...suppliers.map(s => s.id)) + 1 : 1;
                suppliers.push({ id: newId, ...supplierData });
            }
            
            renderSuppliers(suppliers);
            updateSelectOptions('#carSupplier', suppliers, 'Выберите поставщика');
            closeAllModals();
        }
        
        function deleteSupplier(id) {
            suppliers = suppliers.filter(s => s.id !== id);
            renderSuppliers(suppliers);
            updateSelectOptions('#carSupplier', suppliers, 'Выберите поставщика');
        }
        
        // Функции CRUD для городов
        function saveCity() {
            const id = document.getElementById('cityId').value;
            const cityData = {
                name: document.getElementById('cityName').value,
                region: document.getElementById('cityRegion').value,
                country: document.getElementById('cityCountry').value
            };
            
            if (id) {
                // Редактирование существующего города
                const index = cities.findIndex(c => c.id == id);
                if (index !== -1) {
                    cities[index] = { ...cities[index], ...cityData };
                }
            } else {
                // Добавление нового города
                const newId = cities.length > 0 ? Math.max(...cities.map(c => c.id)) + 1 : 1;
                cities.push({ id: newId, ...cityData });
            }
            
            renderCities(cities);
            updateSelectOptions('#carCity', cities, 'Выберите город');
            closeAllModals();
        }
        
        function deleteCity(id) {
            cities = cities.filter(c => c.id !== id);
            renderCities(cities);
            updateSelectOptions('#carCity', cities, 'Выберите город');
        }
        
        // Функции CRUD для марок
        function saveBrand() {
            const id = document.getElementById('brandId').value;
            const brandData = {
                name: document.getElementById('brandName').value,
                country: document.getElementById('brandCountry').value,
                year: document.getElementById('brandYear').value ? parseInt(document.getElementById('brandYear').value) : null,
                description: document.getElementById('brandDescription').value,
                logo: document.getElementById('brandLogoPreview').src
            };
            
            if (id) {
                // Редактирование существующей марки
                const index = brands.findIndex(b => b.id == id);
                if (index !== -1) {
                    brands[index] = { ...brands[index], ...brandData };
                }
            } else {
                // Добавление новой марки
                const newId = brands.length > 0 ? Math.max(...brands.map(b => b.id)) + 1 : 1;
                brands.push({ id: newId, ...brandData });
            }
            
            renderBrands(brands);
            updateSelectOptions('#carBrand', brands, 'Выберите марку');
            updateBrandFilter();
            closeAllModals();
        }
        
        function deleteBrand(id) {
            brands = brands.filter(b => b.id !== id);
            renderBrands(brands);
            updateSelectOptions('#carBrand', brands, 'Выберите марку');
            updateBrandFilter();
        }
        
        // Функции поиска и фильтрации
        function searchCars() {
            const searchTerm = searchInput.value.toLowerCase();
            const brandId = brandFilter.value;
            
            let filteredCars = cars.filter(car => {
                const matchesSearch = 
                    car.brand.toLowerCase().includes(searchTerm) ||
                    car.model.toLowerCase().includes(searchTerm) ||
                    car.equipment.toLowerCase().includes(searchTerm);
                
                const matchesBrand = brandId ? car.brand === brands.find(b => b.id == brandId)?.name : true;
                
                return matchesSearch && matchesBrand;
            });
            
            renderCars(filteredCars);
        }
        
        function resetFilters() {
            searchInput.value = '';
            brandFilter.value = '';
            renderCars(cars);
        }
        
        // Вспомогательные функции
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
    </script>
</body>
</html>
